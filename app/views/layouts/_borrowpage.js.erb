$(document).on('pageshow', '.borrowpage<%=action_name%>', function(e, data){
	$('.borrowpage<%=action_name%> #calendar').fullCalendar({
		editable: false, //Don't allow editing of events
		events: '/getevent/<%=action_name%>',
		defaultView: '<%=@view%>', //Only show week view
		handleWindowResize: true,
		nowIndicator: true,
		allDaySlot: false,
		titleFormat: {
			month: 'YYYY/MM',
			week: 'YYYY/MM/DD', 
			day: 'YYYY/MM/DD dddd'
		},
		columnFormat: {
		    week: 'ddd' // Only show day of the week names
		},
		minTime: '08:00:00', // Start time for the calendar
		maxTime: '22:00:00', //End time for the calendar
		displayEventTime: true, // Display event time
		height: 'auto',
		dayClick: function(date, jsEvent, view) {
			$(".input-date").val(date.format('YYYY-MM-DD'));
			$("#input-starttime").val(date.format('HH:mm'));
			$("#input-endtime").val(date.add(1, 'h').format('HH:mm'));

			$('#popupDialog-<%=action_name%>').popup('open');
		},
		eventClick: function(calEvent, jsEvent, view){
			$("#<%=action_name%>-dialog-title").text("<%='借用人：' if action_name == 'room'%>"+calEvent.title);
			$("#<%=action_name%>-dialog-start span").text(calEvent.start.format('YYYY-MM-DD HH:mm'));
			$("#<%=action_name%>-dialog-end span").text(calEvent.end.format('YYYY-MM-DD HH:mm'));
			<% if action_name == 'calendar' %>
				$("#<%=action_name%>-dialog-content span").text(calEvent.content);
			<% end%>
			$('#popupEvent-<%=action_name%>').popup('open');
		}
	});

	datetime = $('#calendar').fullCalendar('getDate');

	$(".input-date").val(datetime.format('YYYY-MM-DD'));
	$("#input-starttime").val(datetime.format('HH:mm'));
	$("#input-endtime").val(datetime.add(1, 'h').format('HH:mm'));

	$('#formCalendar').submit(function(){
		$('#popupDialog-<%=action_name%>').popup("close");
	});
});