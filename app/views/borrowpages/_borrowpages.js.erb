$(document).on('pageshow', '.borrowpage', function(e, data){
	$('#calendar').fullCalendar({
		editable: false, //Don't allow editing of events
		defaultView: '<%= @view%>', //Only show week view
		handleWindowResize: true,
		allDaySlot: false,
		titleFormat: {
			month: 'YYYY/MM',
			week: 'YYYY/MM/DD', 
			day: 'YYYY/MM/DD dddd'
		},
		columnFormat: {
		    week: 'ddd' // Only show day of the week names
		},
		minTime: '08:00:00', // Start time for the calendar
		maxTime: '22:00:00', //End time for the calendar
		displayEventTime: true, // Display event time
		height: 'auto',
		dayClick: function(date, jsEvent, view) {
			$(".input-date").val(date.format('YYYY-MM-DD'));
			$("#input-starttime").val(date.format('HH:mm'));

			hour_later = zeroPad(parseInt(date.format('HH'))+1, 2);
			$("#input-endtime").val(hour_later +":"+ date.format('mm'));
			$('#popupDialog').popup('open');
		}
	});

	datetime = $('#calendar').fullCalendar('getDate');

	$(".input-date").val(datetime.format('YYYY-MM-DD'));
	$("#input-starttime").val(datetime.format('HH:mm'));

	hour_later = zeroPad(parseInt(datetime.format('HH'))+1, 2);
	$("#input-endtime").val(hour_later +":"+ datetime.format('mm'));

	$('#formCalendar').submit(function(){
		start_time = $('#input-startdate').val() +'T'+ $('#input-starttime').val() + ':00';
		end_time = $('#input-enddate').val() +'T'+ $('#input-endtime').val() + ':00';

		$('#calendar').fullCalendar('renderEvent', {
			title: '<%= session[:user_name]%>',
			start: start_time,
			end: end_time,
			allDay: false
		}, 'stick');
		$('#popupDialog').popup("close");
	});
});

function zeroPad(num, places) {
  var zero = places - num.toString().length + 1;
  return Array(+(zero > 0 && zero)).join("0") + num;
}
